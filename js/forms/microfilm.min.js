!function(){"use strict";var t=angular.module("microfilmApp",[]).config(function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"});t.controller("mfController",function(t,e,i,r,n){var o=BH_general.params.template,c=o+"/views/components/",a=BH_general.params.api,s=function(){t.microfilms=[],t.senderDetails={password:""},t.rc.form.attempted=!1,t.form.$setPristine()},f=!1;t.__defineGetter__("success",function(){return f}),t.__defineSetter__("success",function(e){"boolean"==typeof e&&(f=e,1==e&&(t.error.code=null,s()))}),t.templates={countryList:c+"country-list.html",stateList:c+"state-list.html",provinceList:c+"province-list.html"},t.submitInProgress=!1,t.error={_code:null,get code(){return this._code},set code(e){this._code=e,null!==e&&(t.success=!1)}},t.senderDetails={password:""},t.years=n.years,t.getMicrofilmData=function(){e.get(a+"microfilm-api.php").success(function(t){angular.forEach(t,function(t){i.microfilmData.push(t)})})},Object.defineProperty(t,"microfilmData",{get:function(){return i.microfilmData}}),Object.defineProperty(t,"microfilms",{get:function(){return i.microfilms},set:function(t){i.microfilms=t}}),Object.defineProperty(t,"letters",{get:function(){return r.letters}}),Object.defineProperty(t,"currentLetter",{get:function(){return r.currentLetter},set:function(t){r.currentLetter=t}}),t.addMicrofilm=function(t){i.add(t)},t.removeMicrofilm=function(t){i.remove(t)},t.changeMicrofilm=function(t){i.change(t)},t.findMicrofilm=function(t){return i.findMicrofilm(t)},t.validateMicrofilms=function(){var e=!0;return angular.forEach(t.microfilms,function(t){t.valid||(e=!1)}),e},t.findMatch=function(t){return i.findMatch(t)},t.submitForm=function(){if(!t.submitInProgress&&t.microfilms.length>0&&t.validateMicrofilms()&&""===t.senderDetails.password){t.submitInProgress=!0;var i={microfilms:{}};angular.forEach(t.microfilms,function(t,e){i.microfilms[e]=t.data});for(var r in t.senderDetails)i[r]=t.senderDetails[r];i=$.param(i),e.post(a+"microfilm-api.php",i).success(function(){t.show_payment=!0}).finally(function(){t.submitInProgress=!1})}},t.$watch("senderDetails.country",function(e,i){"United States of America"==i?t.senderDetails.state="":"Canada"==i&&(t.senderDetails.province="")})}),t.factory("MicrofilmManager",function(){var t=function(){this.microfilmData=[],this.microfilms=[]};return t.prototype={add:function(t){var e={data:{}};return t?(e.data.Microfilm=angular.copy(t.Microfilm),e.data.Type=angular.copy(t.Type),e.valid=!0):(e.data={},e.valid=!1),this.microfilms.push(e),e},findMicrofilm:function(t){var e=!1;return angular.forEach(this.microfilms,function(i){t==i.data.Microfilm&&(e=i)}),e},findMatch:function(t){var e=!1,i=function(t,e){var i=!0,r=["Microfilm"];return r.forEach(function(r){t[r]!=e[r]&&(i=!1)}),i};return angular.forEach(this.microfilms,function(r){i(t,r.data)&&(e=r)}),e},findMicrofilmData:function(t){var e=!1;return angular.forEach(this.microfilmData,function(i){t==i.Microfilm&&(e=i)}),e},remove:function(t){var e=this.findMicrofilm(t);e&&this.microfilms.splice(this.microfilms.indexOf(e),1)},change:function(t){var e=this.findMicrofilmData(t.data.Microfilm);e?(t.data.Type=angular.copy(e.Type),t.valid=!0):t.valid=!1}},new t}),t.service("SortService",function(){this.letters=[];for(var t=65;90>=t;t++)this.letters.push(String.fromCharCode(t));this.currentLetter=this.letters[0]}),t.service("YearsService",function(){this.years=[];for(var t=(new Date).getFullYear()-2e3,e=t;99>=e;e++)this.years.push(e)}),t.filter("sortByLetter",function(){return function(t,e){var i=[];return angular.forEach(t,function(t){t.Town[0].toUpperCase()===e&&i.push(t)}),i}}),t.directive("showOnHover",function(){return{restrict:"A",scope:{showOnHover:"@"},link:function(t,e){var i=t.showOnHover+"-show";e.on("mouseenter",function(){$("."+t.showOnHover).addClass(i)}),e.on("mouseleave",function(){$("."+t.showOnHover).removeClass(i)})}}}),t.directive("addPhone",function(){return{restrict:"A",scope:{addPhone:"@"},link:function(t,e){e.click(function(){$("#"+t.addPhone).show(),e.hide()})}}}),t.directive("removePhone",function(){return{restrict:"A",scope:{removePhone:"@",button:"@showButton"},link:function(t,e){e.click(function(){$("#"+t.removePhone).hide(),$("."+t.button).show(),t.$parent.$apply(function(t){t.senderDetails.addphone=""})})}}}),rcSubmitDirective&&t.directive(rcSubmitDirective)}(window,document);