/*! bh.org.il 2021-06-01 */

!function(t,i){"use strict";var e=angular.module("microfilmApp",[]).config(function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"});e.controller("mfController",function(e,i,r,n,t){var o=js_globals.template_url+"/views/components/",c=BH_general.params.api,a=!1;e.__defineGetter__("success",function(){return a}),e.__defineSetter__("success",function(t){"boolean"==typeof t&&1==(a=t)&&(e.error.code=null,e.microfilms=[],e.senderDetails={password:""},e.rc.form.attempted=!1,e.form.$setPristine())}),e.templates={countryList:o+"country-list.html",stateList:o+"state-list.html",provinceList:o+"province-list.html"},e.submitInProgress=!1,e.error={_code:null,get code(){return this._code},set code(t){null!==(this._code=t)&&(e.success=!1)}},e.senderDetails={password:""},e.years=t.years,e.getMicrofilmData=function(){i.get(c+"microfilm-api.php").success(function(t){angular.forEach(t,function(t){r.microfilmData.push(t)})})},Object.defineProperty(e,"microfilmData",{get:function(){return r.microfilmData}}),Object.defineProperty(e,"microfilms",{get:function(){return r.microfilms},set:function(t){r.microfilms=t}}),Object.defineProperty(e,"letters",{get:function(){return n.letters}}),Object.defineProperty(e,"currentLetter",{get:function(){return n.currentLetter},set:function(t){n.currentLetter=t}}),e.addMicrofilm=function(t){r.add(t)},e.removeMicrofilm=function(t){r.remove(t)},e.changeMicrofilm=function(t){r.change(t)},e.findMicrofilm=function(t){return r.findMicrofilm(t)},e.validateMicrofilms=function(){var i=!0;return angular.forEach(e.microfilms,function(t){t.valid||(i=!1)}),i},e.findMatch=function(t){return r.findMatch(t)},e.submitForm=function(){if(!e.submitInProgress&&0<e.microfilms.length&&e.validateMicrofilms()&&""===e.senderDetails.password){e.submitInProgress=!0;var r={microfilms:{}};for(var t in angular.forEach(e.microfilms,function(t,i,e){r.microfilms[i]=t.data}),e.senderDetails)r[t]=e.senderDetails[t];r=$.param(r),i.post(c+"microfilm-api.php",r).success(function(t){e.show_payment=!0}).finally(function(){e.submitInProgress=!1})}},e.$watch("senderDetails.country",function(t,i){"United States of America"==i?e.senderDetails.state="":"Canada"==i&&(e.senderDetails.province="")})}),e.factory("MicrofilmManager",function(){var t=function(){this.microfilmData=[],this.microfilms=[]};return t.prototype={add:function(t){var i={data:{}};return t?(i.data.Microfilm=angular.copy(t.Microfilm),i.data.Type=angular.copy(t.Type),i.valid=!0):(i.data={},i.valid=!1),this.microfilms.push(i),i},findMicrofilm:function(i){var e=!1;return angular.forEach(this.microfilms,function(t){i==t.data.Microfilm&&(e=t)}),e},findMatch:function(n){var o=!1;return angular.forEach(this.microfilms,function(t){var i,e,r;i=n,e=t.data,r=!0,["Microfilm"].forEach(function(t){i[t]!=e[t]&&(r=!1)}),r&&(o=t)}),o},findMicrofilmData:function(i){var e=!1;return angular.forEach(this.microfilmData,function(t){i==t.Microfilm&&(e=t)}),e},remove:function(t){var i=this.findMicrofilm(t);i&&this.microfilms.splice(this.microfilms.indexOf(i),1)},change:function(t){var i=this.findMicrofilmData(t.data.Microfilm);i?(t.data.Type=angular.copy(i.Type),t.valid=!0):t.valid=!1}},new t}),e.service("SortService",function(){this.letters=[];for(var t=65;t<=90;t++)this.letters.push(String.fromCharCode(t));this.currentLetter=this.letters[0]}),e.service("YearsService",function(){this.years=[];for(var t=(new Date).getFullYear()-2e3;t<=99;t++)this.years.push(t)}),e.filter("sortByLetter",function(){return function(t,i){var e=[];return angular.forEach(t,function(t){t.Town[0].toUpperCase()===i&&e.push(t)}),e}}),e.directive("showOnHover",function(){return{restrict:"A",scope:{showOnHover:"@"},link:function(t,i){var e=t.showOnHover+"-show";i.on("mouseenter",function(){$("."+t.showOnHover).addClass(e)}),i.on("mouseleave",function(){$("."+t.showOnHover).removeClass(e)})}}}),e.directive("addPhone",function(){return{restrict:"A",scope:{addPhone:"@"},link:function(t,i){i.click(function(){$("#"+t.addPhone).show(),i.hide()})}}}),e.directive("removePhone",function(){return{restrict:"A",scope:{removePhone:"@",button:"@showButton"},link:function(t,i){i.click(function(){$("#"+t.removePhone).hide(),$("."+t.button).show(),t.$parent.$apply(function(t){t.senderDetails.addphone=""})})}}}),rcSubmitDirective&&e.directive(rcSubmitDirective)}(window,document);